<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Management System</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        input, select, button { display: block; width: 100%; margin: 10px 0; padding: 10px; }
        button { background-color: #28a745; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #218838; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center;">Eden Centre HR System</h2>

    <!-- LOGIN SECTION -->
    <div id="loginSection">
        <h3>Login</h3>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboardSection" class="hidden">
        <div style="display: flex; justify-content: space-between;">
            <h3 id="welcomeMsg">Dashboard</h3>
            <button onclick="logout()" style="width: auto; background-color: #dc3545;">Logout</button>
        </div>
        
        <!-- Add Employee Form (Only visible to Admin) -->
        <div id="adminControls" class="hidden">
            <h4>Add New Employee</h4>
            <input type="text" id="srNo" placeholder="Sr No.">
            <input type="text" id="empName" placeholder="Name">
            <input type="text" id="nrcNo" placeholder="NRC No.">
            <input type="text" id="dept" placeholder="Department (e.g., IT, HR, Admin)">
            <input type="text" id="position" placeholder="Position">
            
            <label>NRC Scan:</label>
            <input type="file" id="nrcFile">
            
            <label>Training Certificate:</label>
            <input type="text" id="trainingName" placeholder="Training Name">
            <input type="file" id="trainingFile">
            
            <!-- ကျန်တဲ့ field တွေ လိုသလိုထပ်ထည့်ပါ -->
            
            <button onclick="addEmployee()">Add Employee</button>
        </div>

        <hr>
        <h4>Employee List</h4>
        <button onclick="loadEmployees()" style="width: auto; background-color: #007bff;">Refresh List</button>
        <div style="overflow-x:auto;">
            <table id="empTable">
                <thead>
                    <tr>
                        <th>Sr</th><th>Name</th><th>NRC</th><th>Dept</th><th>Position</th><th>Files</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // GAS Deployment URL ကို ဒီမှာထည့်ပါ
    const APPS_SCRIPT_URL = 'YOUR_DEPLOYED_WEB_APP_URL_HERE';

    let currentUser = {};

    function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;

        fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'login', username: u, password: p })
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                currentUser = data;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                document.getElementById('welcomeMsg').innerText = `Welcome, ${u} (${data.role})`;
                
                // Admin Role စစ်ခြင်း
                if (data.role === 'Root Admin' || data.role === 'HR Manager') {
                    document.getElementById('adminControls').classList.remove('hidden');
                }
                
                loadEmployees();
            } else {
                alert('Login Failed: ' + data.message);
            }
        });
    }

    function loadEmployees() {
        fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ 
                action: 'getEmployees', 
                role: currentUser.role, 
                dept: currentUser.dept 
            })
        })
        .then(res => res.json())
        .then(response => {
            const tbody = document.querySelector('#empTable tbody');
            tbody.innerHTML = '';
            response.data.forEach(row => {
                // Row Data များကို Table မှာပြခြင်း (Column Index သတိပြုပါ)
                const tr = `<tr>
                    <td>${row[0]}</td>
                    <td>${row[1]}</td>
                    <td>${row[2]}</td>
                    <td>${row[12]}</td>
                    <td>${row[13]}</td>
                    <td>
                        ${row[15] ? `<a href="${row[15]}" target="_blank">NRC</a>` : ''} 
                        ${row[16] ? `<br><a href="${row[16]}" target="_blank">Cert</a>` : ''}
                    </td>
                </tr>`;
                tbody.innerHTML += tr;
            });
        });
    }

    async function addEmployee() {
        // File များကို Base64 ပြောင်းခြင်း
        const nrcInput = document.getElementById('nrcFile');
        const trainingInput = document.getElementById('trainingFile');
        
        let nrcData = await getBase64(nrcInput.files[0]);
        let trainingData = await getBase64(trainingInput.files[0]);

        const payload = {
            action: 'addEmployee',
            srNo: document.getElementById('srNo').value,
            name: document.getElementById('empName').value,
            nrc: document.getElementById('nrcNo').value,
            department: document.getElementById('dept').value,
            position: document.getElementById('position').value,
            trainingName: document.getElementById('trainingName').value,
            // ကျန်တဲ့ field တွေ ဒီမှာထည့်ပါ
            
            nrcFile: nrcData ? { data: nrcData, mimeType: nrcInput.files[0].type } : null,
            trainingFile: trainingData ? { data: trainingData, mimeType: trainingInput.files[0].type } : null
        };

        alert("Uploading... Please wait.");
        
        fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            loadEmployees();
        });
    }

    // Helper to convert file to Base64
    function getBase64(file) {
        return new Promise((resolve, reject) => {
            if (!file) resolve(null);
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    function logout() {
        location.reload();
    }
</script>

</body>
</html>
